name: YouTube to Drive Sync (Safe Mode 720p)
on: [workflow_dispatch]
jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Tools
        run: |
          sudo curl -L https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp -o /usr/local/bin/yt-dlp
          sudo chmod a+rx /usr/local/bin/yt-dlp
          sudo apt-get install rclone -y
      - name: Setup Credentials
        run: |
          mkdir -p ~/.config/rclone
          echo "${{ secrets.RCLONE_CONFIG }}" > ~/.config/rclone/rclone.conf
          echo "${{ secrets.YT_COOKIES }}" > youtube-cookies.txt
      - name: Download & Upload (One by One 720p)
        run: |
          # التحميل بجودة 720p والرفع فوراً ثم الحذف
          yt-dlp --cookies youtube-cookies.txt \
                 --ignore-errors \
                 -f "bestvideo[height<=720][ext=mp4]+bestaudio[ext=m4a]/best[height<=720][ext=mp4]/best" \
                 --exec "rclone move {} gdrive:YouTube_Uploads -v && echo '✅ Uploaded and Deleted: {}'" \
                 "https://www.youtube.com/playlist?list=PL7TpI0K9I87K5qQte9awzBO2QkeMl-UAN"
